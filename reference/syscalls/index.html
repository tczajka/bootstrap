<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Tomek Czajka">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Linux system calls - Echo to Tetris</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../style.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Echo to Tetris</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../hello-world/" class="nav-link">Hello, world!</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Assembler</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../asm/assembler-overview/" class="dropdown-item">Assembler overview</a>
</li>
                                    
<li>
    <a href="../../asm/numbers-and-strings/" class="dropdown-item">Numbers and strings</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../notation/" class="dropdown-item">Notation</a>
</li>
                                    
<li>
    <a href="../ascii/" class="dropdown-item">ASCII</a>
</li>
                                    
<li>
    <a href="../elf/" class="dropdown-item">Linux executable files</a>
</li>
                                    
<li>
    <a href="../x86/" class="dropdown-item">x86 machine code</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Linux system calls</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/tczajka/bootstrap" class="nav-link">Code repository</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../x86/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#linux-system-calls" class="nav-link">Linux system calls</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="linux-system-calls">Linux system calls</h1>
<p>We write our code for Linux under 32-bit mode. Nowadays everybody has 64-bit computers, but
32-bit mode programs are supported under 64-bit Linuxes, so we use that.</p>
<p>To call an operating system kernel service we use "system calls". Under 32-bit Linux these
are entered via the <code>int $80</code> (interrupt 128, or $80 in hexadecimal) machine code instruction.</p>
<p>Parameters are put in registers (eax, ebx, ...), and the return value is returned in the eax register.</p>
<p>The system calls we need are:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th style="text-align: right;">eax</th>
<th>ebx</th>
<th>ecx</th>
<th>edx</th>
<th>return value</th>
</tr>
</thead>
<tbody>
<tr>
<td>exit</td>
<td>exit the program</td>
<td style="text-align: right;">1</td>
<td>program return code</td>
<td></td>
<td></td>
<td>none</td>
</tr>
<tr>
<td>read</td>
<td>read from a file</td>
<td style="text-align: right;">3</td>
<td>file descriptor</td>
<td>buffer address</td>
<td>buffer size</td>
<td>number of bytes read</td>
</tr>
<tr>
<td>write</td>
<td>write to a file</td>
<td style="text-align: right;">4</td>
<td>file descriptor</td>
<td>data address</td>
<td>data length</td>
<td>number of bytes written</td>
</tr>
<tr>
<td>brk</td>
<td>allocate memory</td>
<td style="text-align: right;">45</td>
<td>memory limit request</td>
<td></td>
<td></td>
<td>new memory limit</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><code>exit</code> never returns. The program return code is a 1-byte code returned to the operating
  system. In <code>bash</code> it can be inspected using the <code>$?</code> special variable. 0 represents
  a normal exit, non-zero values represent failures.</p>
</li>
<li>
<p><code>read</code> reads up to <code>buffer size</code> bytes into the provided buffer from a file descriptor.
  File descriptor 0 is the standard input. Fewer bytes may be read than requested (but
  always at least 1, except on errors and end of file). 0 indicates end of file, -1 indicates
  an error.</p>
</li>
<li>
<p><code>write</code> writes up to <code>data length</code> bytes into a file descriptor. File descriptor 1 is the
  standard output, file descriptor 2 is the standard error stream. Fewer bytes may be written
  than requested (but always at least 1, except on errors). -1 indicates an error.</p>
</li>
<li>
<p><code>brk</code> changes the size of heap memory. We may ask to have memory allocated
  up to some limit, and the actual allocation is returned (it may be smaller if our request
  can't be satisfied). We can find out the initial address of (initially empty) heap memory
  by calling <code>brk(0)</code>.</p>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
